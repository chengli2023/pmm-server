{"ast":null,"code":"var equal = require('deep-equal');\n\nvar extend = require('extend');\n\nvar lib = {\n  attributes: {\n    compose: function (a, b, keepNull) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = extend(true, {}, b);\n\n      if (!keepNull) {\n        attributes = Object.keys(attributes).reduce(function (copy, key) {\n          if (attributes[key] != null) {\n            copy[key] = attributes[key];\n          }\n\n          return copy;\n        }, {});\n      }\n\n      for (var key in a) {\n        if (a[key] !== undefined && b[key] === undefined) {\n          attributes[key] = a[key];\n        }\n      }\n\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n    diff: function (a, b) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = Object.keys(a).concat(Object.keys(b)).reduce(function (attributes, key) {\n        if (!equal(a[key], b[key])) {\n          attributes[key] = b[key] === undefined ? null : b[key];\n        }\n\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n    transform: function (a, b, priority) {\n      if (typeof a !== 'object') return b;\n      if (typeof b !== 'object') return undefined;\n      if (!priority) return b; // b simply overwrites us without priority\n\n      var attributes = Object.keys(b).reduce(function (attributes, key) {\n        if (a[key] === undefined) attributes[key] = b[key]; // null is a valid value\n\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    }\n  },\n  iterator: function (ops) {\n    return new Iterator(ops);\n  },\n  length: function (op) {\n    if (typeof op['delete'] === 'number') {\n      return op['delete'];\n    } else if (typeof op.retain === 'number') {\n      return op.retain;\n    } else {\n      return typeof op.insert === 'string' ? op.insert.length : 1;\n    }\n  }\n};\n\nfunction Iterator(ops) {\n  this.ops = ops;\n  this.index = 0;\n  this.offset = 0;\n}\n\n;\n\nIterator.prototype.hasNext = function () {\n  return this.peekLength() < Infinity;\n};\n\nIterator.prototype.next = function (length) {\n  if (!length) length = Infinity;\n  var nextOp = this.ops[this.index];\n\n  if (nextOp) {\n    var offset = this.offset;\n    var opLength = lib.length(nextOp);\n\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n\n    if (typeof nextOp['delete'] === 'number') {\n      return {\n        'delete': length\n      };\n    } else {\n      var retOp = {};\n\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n\n      return retOp;\n    }\n  } else {\n    return {\n      retain: Infinity\n    };\n  }\n};\n\nIterator.prototype.peek = function () {\n  return this.ops[this.index];\n};\n\nIterator.prototype.peekLength = function () {\n  if (this.ops[this.index]) {\n    // Should never return 0 if our index is being managed correctly\n    return lib.length(this.ops[this.index]) - this.offset;\n  } else {\n    return Infinity;\n  }\n};\n\nIterator.prototype.peekType = function () {\n  if (this.ops[this.index]) {\n    if (typeof this.ops[this.index]['delete'] === 'number') {\n      return 'delete';\n    } else if (typeof this.ops[this.index].retain === 'number') {\n      return 'retain';\n    } else {\n      return 'insert';\n    }\n  }\n\n  return 'retain';\n};\n\nIterator.prototype.rest = function () {\n  if (!this.hasNext()) {\n    return [];\n  } else if (this.offset === 0) {\n    return this.ops.slice(this.index);\n  } else {\n    var offset = this.offset;\n    var index = this.index;\n    var next = this.next();\n    var rest = this.ops.slice(this.index);\n    this.offset = offset;\n    this.index = index;\n    return [next].concat(rest);\n  }\n};\n\nmodule.exports = lib;","map":{"version":3,"names":["equal","require","extend","lib","attributes","compose","a","b","keepNull","Object","keys","reduce","copy","key","undefined","length","diff","concat","transform","priority","iterator","ops","Iterator","op","retain","insert","index","offset","prototype","hasNext","peekLength","Infinity","next","nextOp","opLength","retOp","substr","peek","peekType","rest","slice","module","exports"],"sources":["/Users/licheng/Documents/untitled/node_modules/quill-delta/lib/op.js"],"sourcesContent":["var equal = require('deep-equal');\nvar extend = require('extend');\n\n\nvar lib = {\n  attributes: {\n    compose: function (a, b, keepNull) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = extend(true, {}, b);\n      if (!keepNull) {\n        attributes = Object.keys(attributes).reduce(function (copy, key) {\n          if (attributes[key] != null) {\n            copy[key] = attributes[key];\n          }\n          return copy;\n        }, {});\n      }\n      for (var key in a) {\n        if (a[key] !== undefined && b[key] === undefined) {\n          attributes[key] = a[key];\n        }\n      }\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n\n    diff: function(a, b) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = Object.keys(a).concat(Object.keys(b)).reduce(function (attributes, key) {\n        if (!equal(a[key], b[key])) {\n          attributes[key] = b[key] === undefined ? null : b[key];\n        }\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n\n    transform: function (a, b, priority) {\n      if (typeof a !== 'object') return b;\n      if (typeof b !== 'object') return undefined;\n      if (!priority) return b;  // b simply overwrites us without priority\n      var attributes = Object.keys(b).reduce(function (attributes, key) {\n        if (a[key] === undefined) attributes[key] = b[key];  // null is a valid value\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    }\n  },\n\n  iterator: function (ops) {\n    return new Iterator(ops);\n  },\n\n  length: function (op) {\n    if (typeof op['delete'] === 'number') {\n      return op['delete'];\n    } else if (typeof op.retain === 'number') {\n      return op.retain;\n    } else {\n      return typeof op.insert === 'string' ? op.insert.length : 1;\n    }\n  }\n};\n\n\nfunction Iterator(ops) {\n  this.ops = ops;\n  this.index = 0;\n  this.offset = 0;\n};\n\nIterator.prototype.hasNext = function () {\n  return this.peekLength() < Infinity;\n};\n\nIterator.prototype.next = function (length) {\n  if (!length) length = Infinity;\n  var nextOp = this.ops[this.index];\n  if (nextOp) {\n    var offset = this.offset;\n    var opLength = lib.length(nextOp)\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n    if (typeof nextOp['delete'] === 'number') {\n      return { 'delete': length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  } else {\n    return { retain: Infinity };\n  }\n};\n\nIterator.prototype.peek = function () {\n  return this.ops[this.index];\n};\n\nIterator.prototype.peekLength = function () {\n  if (this.ops[this.index]) {\n    // Should never return 0 if our index is being managed correctly\n    return lib.length(this.ops[this.index]) - this.offset;\n  } else {\n    return Infinity;\n  }\n};\n\nIterator.prototype.peekType = function () {\n  if (this.ops[this.index]) {\n    if (typeof this.ops[this.index]['delete'] === 'number') {\n      return 'delete';\n    } else if (typeof this.ops[this.index].retain === 'number') {\n      return 'retain';\n    } else {\n      return 'insert';\n    }\n  }\n  return 'retain';\n};\n\nIterator.prototype.rest = function () {\n  if (!this.hasNext()) {\n    return [];\n  } else if (this.offset === 0) {\n    return this.ops.slice(this.index);\n  } else {\n    var offset = this.offset;\n    var index = this.index;\n    var next = this.next();\n    var rest = this.ops.slice(this.index);\n    this.offset = offset;\n    this.index = index;\n    return [next].concat(rest);\n  }\n};\n\n\nmodule.exports = lib;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}